<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UNAGENT — Event Stream</title>
  <style>
    :root {
      color-scheme: light;
    }
    body {
      font-family: system-ui, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 1rem;
      color: #222;
    }
    h1 {
      font-size: 1rem;
      font-weight: 500;
      margin: 0 0 1rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }
    .subtitle {
      font-size: 0.85rem;
      color: #777;
      margin-bottom: 1rem;
    }
    .event {
      background: white;
      padding: 0.65rem 0.75rem;
      margin-bottom: 0.5rem;
      border-left: 3px solid #ccc;
      font-size: 0.85rem;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
    }
    .type {
      font-weight: 600;
      color: #555;
    }
    .summary {
      margin-top: 0.25rem;
    }
    .meta {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.35rem;
      color: #999;
      font-size: 0.75rem;
    }
    .empty {
      font-size: 0.85rem;
      color: #888;
      padding: 1rem 0;
    }
  </style>
</head>
<body>
  <h1>Event Stream (read-only)</h1>
  <div class="subtitle">This viewer exists so you can look, not react.</div>

  <div id="events" class="events"></div>
  <div id="empty" class="empty">No events yet. Check back later.</div>

  <script>
    let lastID = 0;

    async function poll() {
      const res = await fetch(`/events?since=${lastID}`);
      const data = await res.json();

      if (data.length > 0) {
        document.getElementById("empty").style.display = "none";
      }

      data.forEach((event) => {
        lastID = Math.max(lastID, event.id);
        render(event);
      });
    }

    function render(event) {
      const div = document.createElement("div");
      div.className = "event";
      div.innerHTML = `
        <div class="type">${event.type}</div>
        <div class="summary">${event.summary}</div>
        <div class="meta">
          <span>${new Date(event.ts / 1e6).toLocaleString()}</span>
          <span>•</span>
          <span>${event.key || "—"}</span>
        </div>
      `;

      const container = document.getElementById("events");
      container.prepend(div);
    }

    setInterval(poll, 2000);
    poll();
  </script>
</body>
</html>
